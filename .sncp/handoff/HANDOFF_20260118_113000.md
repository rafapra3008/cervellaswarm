# HANDOFF - Sessione 259

> **Data:** 18 Gennaio 2026
> **Progetto:** Miracollo PMS
> **Focus:** Fix Deploy + Subroadmap DEPLOY_BLINDATO

---

## COSA ABBIAMO FATTO

### 3 Problemi Risolti

```
1. PLANNING 404
   Causa: Conflitto naming (planning.py file vs planning/ cartella)
   Python importava dalla cartella invece del file!
   Fix: Rinominato planning.py → planning_core.py
   Commit: 7c2867f (Miracollo)

2. PRENOTAZIONI APPAIONO/SPARISCONO
   Causa: 2 container backend con stesso alias DNS "backend"
   Nginx a volte risolveva uno, a volte l'altro
   Fix: Rimosso container rogue, aggiunto name:miracollo al compose
   Commit: 2436923 (Miracollo)

3. MIGRATION DB MANCANTE
   Causa: Colonna 'imported' non esisteva
   Fix: Eseguita migration 025 sulla VM con sudo
```

### Subroadmap Creata

```
Path: .sncp/roadmaps/SUBROADMAP_DEPLOY_BLINDATO.md

FASE 1: Fix immediato          ✓ COMPLETATA
FASE 2: Guardrail tecnici      ← PROSSIMO
FASE 3: Un solo entry point
FASE 4: Wizard interattivo
FASE 5: Monitoraggio

Principio guida:
"Rendere il PATH CORRETTO più FACILE del path sbagliato"
```

---

## STATO PRODUZIONE

```
VM MIRACOLLO (miracollo-vm):
- 1 container: miracollo-backend-1 (healthy)
- 1 container: miracollo-nginx (healthy)
- docker-compose.yml ha name:miracollo
- Planning: FUNZIONA (testato 3 volte consecutivo)
```

---

## PROSSIMA SESSIONE

```
PRIORITÀ 1: Test VCC
- Il codice è pronto dalla sessione 258
- Aprire prenotazione → Pagamento → VCC Booking
- Carta test: 4242 4242 4242 4242

PRIORITÀ 2: FASE 2 subroadmap
- Wrapper bash su VM che blocca "docker run"
- Serve per prevenire errori futuri

PRIORITÀ 3: Documentazione VCC
- Documentare in docs/
```

---

## COMMIT

```
Miracollo:
- 7c2867f: Fix Planning endpoint 404
- 2436923: Fix docker-compose project name

CervellaSwarm:
- 3b16f4a: Checkpoint Sessione 259
```

---

## FILE CHIAVE

| File | Cosa |
|------|------|
| `SUBROADMAP_DEPLOY_BLINDATO.md` | Piano per prevenire errori deploy |
| `PROMPT_RIPRESA_miracollo.md` | Stato aggiornato Miracollo |
| `planning_core.py` | Ex planning.py (rinominato!) |

---

## LEZIONI APPRESE

```
1. Python preferisce cartelle (packages) a file con stesso nome
   Se hai file.py e file/ → Python importa da file/

2. "docker compose restart" NON ricarica il codice
   Serve "docker compose up -d --build"

3. Container senza nome esplicito usano il nome della cartella
   name:miracollo nel compose previene confusione
```

---

*"Lavoriamo in pace! Senza casino! Dipende da noi!"*
